{
  "pluginAlias": "AhoyDTU",
  "pluginType": "platform",
  "singular": false,
  "headerDisplay": "<p align='center'><img width='100px' src='https://raw.githubusercontent.com/homebridge/branding/latest/logos/homebridge-wordmark-logo-vertical.png'></p><p align='center'>Monitor your AHOY-DTU solar inverter data in Apple HomeKit via MQTT.</p><p align='center'><b>Quick Setup:</b> Enter your MQTT server details below, then choose Discovery mode to find all available devices, or use a preset for instant setup.</p>",
  "footerDisplay": "<p align='center'>For support and documentation, visit the <a href='https://github.com/chr-braun/homebridge-ahoy-dtu' target='_blank'>GitHub repository</a>.</p>",
  "schema": {
    "type": "object",
    "properties": {
      "uiLanguage": {
        "title": "ğŸŒ UI Language / BenutzeroberflÃ¤che Sprache / Langue de l'interface",
        "type": "string",
        "enum": ["de", "en", "fr"],
        "enumNames": ["ğŸ‡©ğŸ‡ª Deutsch", "ğŸ‡ºğŸ‡¸ English", "ğŸ‡«ğŸ‡· FranÃ§ais"],
        "default": "en",
        "description": "Choose your preferred language for the configuration interface"
      },
      "name": {
        "title": "Platform Name",
        "type": "string",
        "default": "AHOY-DTU Solar",
        "required": true,
        "description": "Name for this platform instance in Homebridge logs"
      },
      "mqttHost": {
        "title": "MQTT Server IP Address",
        "type": "string",
        "format": "hostname",
        "placeholder": "192.168.1.100",
        "required": true,
        "description": "IP address of your MQTT broker (where AHOY-DTU publishes data)"
      },
      "mqttPort": {
        "title": "MQTT Port",
        "type": "integer",
        "default": 1883,
        "placeholder": "1883",
        "description": "MQTT broker port (standard: 1883 for unencrypted, 8883 for SSL)"
      },
      "mqttUsername": {
        "title": "MQTT Username",
        "type": "string",
        "description": "Username for MQTT authentication (leave empty if not required)"
      },
      "mqttPassword": {
        "title": "MQTT Password",
        "type": "string",
        "description": "Password for MQTT authentication (leave empty if not required)"
      },
      "discoverDevices": {
        "title": "Device Discovery Mode",
        "type": "boolean",
        "default": false,
        "description": "ğŸ” Enable to discover all available MQTT topics from your AHOY-DTU (check logs after 30 seconds, then disable this and configure devices below)"
      },
      "usePreset": {
        "title": "Quick Setup Preset",
        "type": "string",
        "enum": ["", "basic", "detailed", "individual-inverters"],
        "enumNames": ["Custom Selection (use selectedDevices below)", "ğŸ“Š Basic (Power + Energy + Status)", "ğŸ“ˆ Detailed (Adds Temperature + Efficiency + Total Energy)", "ğŸ”¢ Individual Inverters (Multiple inverter monitoring)"],
        "description": "ğŸš€ Choose a preset for instant setup, or select 'Custom' to manually choose topics"
      },
      "selectedDevices": {
        "title": "Custom MQTT Topics",
        "type": "array",
        "items": {
          "type": "string",
          "title": "MQTT Topic",
          "placeholder": "AHOY-DTU_TOTAL/power"
        },
        "condition": {
          "functionBody": "return !model.usePreset || model.usePreset === '';"
        },
        "description": "ğŸ“ Manually specify MQTT topics to create HomeKit devices for. Use Discovery Mode first to see available topics."
      },
      "maxEnergyPerDay": {
        "title": "Maximum Daily Energy Production (kWh)",
        "type": "number",
        "default": 10,
        "minimum": 1,
        "maximum": 100,
        "multipleOf": 0.1,
        "description": "âš¡ Expected maximum daily energy production of your solar system for accurate percentage calculation in HomeKit"
      },
      "offlineThresholdMinutes": {
        "title": "Offline Detection Threshold (Minutes)",
        "type": "number",
        "default": 15,
        "minimum": 5,
        "maximum": 120,
        "description": "ğŸŒ™ Minutes without MQTT data before marking device offline (normal during night or no sunlight)"
      },
      "usePowerOutlets": {
        "title": "Use Outlet Service for Power Measurement",
        "type": "boolean",
        "default": false,
        "description": "âš¡ Enable to show power values in actual Watts using Outlet service instead of Lux (Light Sensor). Outlets display true power consumption and can be controlled in HomeKit."
      },
      "dailyReports": {
        "title": "Daily Solar Reports",
        "type": "object",
        "properties": {
          "enabled": {
            "title": "Enable Daily Reports",
            "type": "boolean",
            "default": false,
            "description": "ğŸ“Š Enable end-of-day solar production reports delivered as HomeKit notifications"
          },
          "language": {
            "title": "Report Language",
            "type": "string",
            "enum": ["en", "de", "fr", "it", "zh"],
            "enumNames": ["ğŸ‡ºğŸ‡¸ English", "ğŸ‡©ğŸ‡ª Deutsch", "ğŸ‡«ğŸ‡· FranÃ§ais", "ğŸ‡®ğŸ‡¹ Italiano", "ğŸ‡¨ğŸ‡³ ä¸­æ–‡"],
            "default": "en",
            "condition": {
              "functionBody": "return model.dailyReports && model.dailyReports.enabled;"
            },
            "description": "ğŸŒ Language for daily report messages and notifications"
          },
          "reportStyle": {
            "title": "Report Delivery Method",
            "type": "string",
            "enum": ["motion", "doorbell", "switch"],
            "enumNames": ["ğŸš¶ Motion Sensor (with notification)", "ğŸ”” Doorbell Alert", "ğŸ”˜ Programmable Switch"],
            "default": "motion",
            "condition": {
              "functionBody": "return model.dailyReports && model.dailyReports.enabled;"
            },
            "description": "ğŸ“± How to deliver daily reports in HomeKit"
          },
          "reportTime": {
            "title": "Report Time",
            "type": "string",
            "enum": ["sunset", "sunset+30", "sunset+60", "20:00", "21:00", "22:00"],
            "enumNames": ["ğŸŒ… At sunset", "ğŸŒ… Sunset + 30 min", "ğŸŒ… Sunset + 1 hour", "ğŸ• 8:00 PM", "ğŸ•˜ 9:00 PM", "ğŸ•™ 10:00 PM"],
            "default": "sunset+30",
            "condition": {
              "functionBody": "return model.dailyReports && model.dailyReports.enabled;"
            },
            "description": "â° When to send daily solar production reports"
          },
          "includeComparisons": {
            "title": "Include Daily Comparisons",
            "type": "boolean",
            "default": true,
            "condition": {
              "functionBody": "return model.dailyReports && model.dailyReports.enabled;"
            },
            "description": "ğŸ“ˆ Include comparisons with yesterday and weekly averages in reports"
          }
        }
      },
      "mqttTopic": {
        "title": "MQTT Topic Prefix (Legacy)",
        "type": "string",
        "default": "AHOY-DTU_TOTAL",
        "description": "Legacy AHOY-DTU topic prefix - use selectedDevices instead for better control"
      }
    }
  },
  "layout": [
    {
      "type": "fieldset",
      "title": "ğŸ“ Basic Configuration",
      "description": "Essential settings to get started",
      "expandable": false,
      "items": [
        "name"
      ]
    },
    {
      "type": "fieldset",
      "title": "ğŸ”Œ MQTT Connection",
      "description": "Configure connection to your MQTT broker where AHOY-DTU publishes data",
      "expandable": false,
      "items": [
        "mqttHost",
        "mqttPort",
        {
          "type": "fieldset",
          "title": "Authentication (Optional)",
          "expandable": true,
          "expanded": false,
          "items": [
            "mqttUsername",
            "mqttPassword"
          ]
        }
      ]
    },
    {
      "type": "fieldset",
      "title": "ğŸ”§ Device Setup",
      "description": "Choose how to configure your HomeKit devices",
      "expandable": false,
      "items": [
        {
          "type": "help",
          "helpvalue": "<div style='background: #f0f8ff; padding: 15px; border-radius: 8px; border-left: 4px solid #0066cc; margin: 10px 0;'><h5 style='margin-top: 0; color: #0066cc;'>ğŸ’¡ Setup Methods:</h5><ul style='margin: 5px 0;'><li><strong>Discovery Mode:</strong> Find all available MQTT topics from your AHOY-DTU</li><li><strong>Quick Presets:</strong> Instant setup with predefined device collections</li><li><strong>Custom Selection:</strong> Manually choose specific MQTT topics</li></ul></div>"
        },
        "discoverDevices",
        "usePreset",
        "selectedDevices"
      ]
    },
    {
      "type": "fieldset",
      "title": "âš™ï¸ Advanced Settings",
      "description": "Fine-tune behavior and thresholds",
      "expandable": true,
      "expanded": false,
      "items": [
        "maxEnergyPerDay",
        "offlineThresholdMinutes",
        "usePowerOutlets",
        {
          "type": "fieldset",
          "title": "ğŸ“Š Daily Solar Reports (Beta)",
          "expandable": true,
          "expanded": false,
          "items": [
            "dailyReports.enabled",
            "dailyReports.language",
            "dailyReports.reportStyle", 
            "dailyReports.reportTime",
            "dailyReports.includeComparisons"
          ]
        },
        {
          "type": "help",
          "helpvalue": "<div style='background: #fff8dc; padding: 10px; border-radius: 5px; margin: 10px 0;'><strong>ğŸ“„ Common AHOY-DTU Topics:</strong><br/>â€¢ <code>AHOY-DTU_TOTAL/power</code> - Current power output<br/>â€¢ <code>AHOY-DTU_TOTAL/energy_today</code> - Daily energy production<br/>â€¢ <code>AHOY-DTU_TOTAL/temperature</code> - Inverter temperature<br/>â€¢ <code>AHOY-DTU_TOTAL/status</code> - System status<br/>â€¢ <code>AHOY-DTU_123456/power</code> - Individual inverter power</div>"
        }
      ]
    },
    {
      "type": "fieldset",
      "title": "ğŸ“œ Legacy Support",
      "expandable": true,
      "expanded": false,
      "items": [
        "mqttTopic"
      ]
    }
  ],
  "form": [
    {
      "type": "help",
      "helpvalue": "<div style='background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 10px; text-align: center; margin-bottom: 20px;'><h3 style='margin: 0; color: white;'>ğŸŒ AHOY-DTU Solar Monitor</h3><p style='margin: 10px 0 0 0; opacity: 0.9;'>Monitor your solar inverter in Apple HomeKit</p></div>"
    },
    "*",
    {
      "type": "help",
      "helpvalue": "<div style='background: #f0fdf4; border: 1px solid #bbf7d0; padding: 15px; border-radius: 8px; margin-top: 20px;'><h5 style='color: #15803d; margin-top: 0;'>ğŸš€ Quick Start Guide:</h5><ol style='margin: 5px 0; color: #166534;'><li>Enter your MQTT server IP above</li><li>Enable 'Device Discovery Mode' and save</li><li>Restart Homebridge and check logs for discovered topics</li><li>Disable discovery, choose a preset or add custom topics</li><li>Save and restart - your solar data will appear in HomeKit!</li></ol></div>"
    },
    {
      "type": "help",
      "helpvalue": "<div style='background: #fef3c7; border: 1px solid #f59e0b; padding: 15px; border-radius: 8px; margin-top: 10px;'><h5 style='color: #92400e; margin-top: 0;'>âš¡ Power Measurement Options:</h5><p style='margin: 5px 0; color: #92400e;'><strong>Light Sensor (Default):</strong> Shows power as 'Lux' - works on all HomeKit versions<br/><strong>Outlet Service (New):</strong> Shows actual Watts and power state - more intuitive display</p><p style='margin: 5px 0; color: #92400e; font-size: 0.9em;'><em>Enable 'Use Outlet Service for Power Measurement' in Advanced Settings to display power in true Watts.</em></p></div>"
    },
    {
      "type": "help",
      "helpvalue": "<div style='background: #f0f9ff; border: 1px solid #0ea5e9; padding: 15px; border-radius: 8px; margin-top: 10px;'><h5 style='color: #0c4a6e; margin-top: 0;'>ğŸ“Š Daily Solar Reports (Beta):</h5><p style='margin: 5px 0; color: #0c4a6e;'><strong>Smart Notifications:</strong> Get end-of-day solar production summaries delivered as HomeKit notifications in your preferred language</p><ul style='margin: 5px 0; color: #0c4a6e;'><li>ğŸŒ Multi-language support (English, German, French, Italian, Chinese)</li><li>ğŸ“ Energy totals, peak power, and efficiency metrics</li><li>ğŸ“ˆ Smart comparisons with yesterday and weekly averages</li><li>ğŸŒ… Automatic sunset-based timing or custom schedule</li></ul><p style='margin: 5px 0; color: #0c4a6e; font-size: 0.9em;'><em>Reports are delivered via Motion Sensor notifications, perfect for HomeKit automations!</em></p></div>"
    }
  ]
}
