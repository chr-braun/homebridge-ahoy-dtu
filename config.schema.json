{
  "pluginAlias": "KostalInverter",
  "pluginType": "platform",
  "headerDisplay": "Kostal Plenticore Solar Inverter Plugin",
  "headerDescription": "Integriert Kostal Plenticore Wechselrichter über HTTP/REST API in HomeKit",
  "schema": {
    "type": "object",
    "properties": {
      "name": {
        "title": "Platform Name",
        "type": "string",
        "default": "Kostal Plenticore",
        "description": "Name der Platform in Homebridge"
      },
      "host": {
        "title": "Wechselrichter IP-Adresse",
        "type": "string",
        "default": "192.168.1.100",
        "description": "IP-Adresse deines Kostal Plenticore Wechselrichters"
      },
      "port": {
        "title": "Port",
        "type": "integer",
        "default": 80,
        "minimum": 1,
        "maximum": 65535,
        "description": "Port für die HTTP-Verbindung (Standard: 80)"
      },
      "pollingInterval": {
        "title": "Aktualisierungsintervall (Sekunden)",
        "type": "integer",
        "default": 30,
        "minimum": 10,
        "maximum": 300,
        "description": "Wie oft sollen die Daten vom Wechselrichter abgerufen werden?"
      },
      "enableMainInverter": {
        "title": "Hauptwechselrichter aktivieren",
        "type": "boolean",
        "default": true,
        "description": "Hauptwechselrichter mit Leistung, Temperatur und Status anzeigen"
      },
      "enableStringMonitoring": {
        "title": "PV-String-Überwachung aktivieren",
        "type": "boolean",
        "default": true,
        "description": "Einzelne PV-Strings mit Spannung und Status überwachen"
      },
      "energyProvider": {
        "title": "Apple Home Energy Provider",
        "type": "object",
        "properties": {
          "enabled": {
            "title": "Energy Provider aktivieren",
            "type": "boolean",
            "default": true,
            "description": "Als Apple Home Energy Provider anzeigen (iOS 16+). Erscheint im Apple Home Energie-Widget."
          },
          "name": {
            "title": "Energy Provider Name",
            "type": "string",
            "default": "Kostal Solar",
            "description": "Name des Energy Providers in Apple Home"
          }
        },
        "description": "Apple Home Energy Provider Einstellungen für iOS 16+"
      },
      "stringCount": {
        "title": "Anzahl PV-Strings",
        "type": "integer",
        "default": 3,
        "minimum": 1,
        "maximum": 10,
        "description": "Wie viele PV-Strings hat deine Anlage?",
        "condition": {
          "functionBody": "return model.enableStringMonitoring === true;"
        }
      },
      "apiEndpoints": {
        "title": "API-Endpunkte",
        "type": "object",
        "properties": {
          "processData": {
            "title": "Prozessdaten-Endpunkt",
            "type": "string",
            "default": "/api/v1/processdata",
            "description": "Endpunkt für Leistungs- und Energiedaten"
          },
          "systemData": {
            "title": "Systemdaten-Endpunkt",
            "type": "string",
            "default": "/api/v1/systemdata",
            "description": "Endpunkt für Temperatur- und Statusdaten"
          }
        },
        "description": "API-Endpunkte für verschiedene Datentypen"
      },
      "advanced": {
        "title": "Erweiterte Einstellungen",
        "type": "object",
        "properties": {
          "timeout": {
            "title": "HTTP-Timeout (ms)",
            "type": "integer",
            "default": 10000,
            "minimum": 1000,
            "maximum": 60000,
            "description": "Timeout für HTTP-Anfragen"
          },
          "retryAttempts": {
            "title": "Wiederholungsversuche",
            "type": "integer",
            "default": 3,
            "minimum": 1,
            "maximum": 10,
            "description": "Anzahl der Wiederholungsversuche bei Fehlern"
          },
          "enableDebugLogging": {
            "title": "Debug-Logging aktivieren",
            "type": "boolean",
            "default": false,
            "description": "Detaillierte Logs für Fehlerbehebung"
          },
          "usePythonBridge": {
            "title": "Python-Bridge verwenden",
            "type": "boolean",
            "default": false,
            "description": "Verwende die Python-Bridge (pykoplenti) für bessere Datenabfrage. Erfordert Python 3.13+ und pykoplenti."
          }
        }
      }
    },
    "required": ["host"]
  },
  "form": [
    {
      "type": "string",
      "key": "name",
      "title": "Platform Name"
    },
    {
      "type": "string",
      "key": "host",
      "title": "Wechselrichter IP-Adresse"
    },
    {
      "type": "number",
      "key": "port",
      "title": "Port"
    },
    {
      "type": "number",
      "key": "pollingInterval",
      "title": "Aktualisierungsintervall (Sekunden)"
    },
    {
      "type": "checkbox",
      "key": "enableMainInverter",
      "title": "Hauptwechselrichter aktivieren"
    },
    {
      "type": "checkbox",
      "key": "enableStringMonitoring",
      "title": "PV-String-Überwachung aktivieren"
    },
    {
      "type": "fieldset",
      "title": "Apple Home Energy Provider",
      "items": [
        {
          "type": "checkbox",
          "key": "energyProvider.enabled",
          "title": "Energy Provider aktivieren"
        },
        {
          "type": "string",
          "key": "energyProvider.name",
          "title": "Energy Provider Name"
        }
      ]
    },
    {
      "type": "number",
      "key": "stringCount",
      "title": "Anzahl PV-Strings",
      "condition": "enableStringMonitoring"
    },
    {
      "type": "fieldset",
      "title": "API-Endpunkte",
      "items": [
        {
          "type": "string",
          "key": "apiEndpoints.processData",
          "title": "Prozessdaten-Endpunkt"
        },
        {
          "type": "string",
          "key": "apiEndpoints.systemData",
          "title": "Systemdaten-Endpunkt"
        }
      ]
    },
    {
      "type": "fieldset",
      "title": "Erweiterte Einstellungen",
      "items": [
        {
          "type": "number",
          "key": "advanced.timeout",
          "title": "HTTP-Timeout (ms)"
        },
        {
          "type": "number",
          "key": "advanced.retryAttempts",
          "title": "Wiederholungsversuche"
        },
        {
          "type": "checkbox",
          "key": "advanced.enableDebugLogging",
          "title": "Debug-Logging aktivieren"
        },
        {
          "type": "checkbox",
          "key": "advanced.usePythonBridge",
          "title": "Python-Bridge verwenden"
        }
      ]
    }
  ]
}
